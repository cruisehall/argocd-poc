apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
data:
  repositories: |
    - url: https://github.com/cruisehall/hello-world-golang-server.git
---
apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: argocd-poc
spec:
  description: Proof of Concept Argo Project
  # Allow manifests to deploy from any git repos
  sourceRepos:
  - '*'
  # Only permit applications to deploy to the hello-world namespace in the same cluster
  destinations:
  - namespace: hello-world
    server: https://kubernetes.default.svc
  # Deny all cluster-scoped resources from being created, except for Namespace
  clusterResourceWhitelist:
  - group: ''
    kind: Namespace
  # Allow all namespaced-scoped resources to be created, except for ResourceQuota, LimitRange, NetworkPolicy
  namespaceResourceBlacklist:
  - group: ''
    kind: ResourceQuota
  - group: ''
    kind: LimitRange
  - group: ''
    kind: NetworkPolicy
  roles:
  # A role which provides read-only access to all applications in the project
  - name: read-only
    description: Read-only privileges to argocd-poc
    policies:
    - p, proj:argocd-poc:read-only, applications, get, argocd-poc/*, allow
  # A role which provides sync privileges to only the hello-world-golang-server application, e.g. to provide
  # sync privileges to a CI system
  - name: ci-role
    description: Sync privileges for hello-world-golang-server
    policies:
    - p, proj:argocd-poc:ci-role, applications, sync, argocd-poc/hello-world-golang-server, allow
    # NOTE: JWT tokens can only be generated by the API server and the token is not persisted
    # anywhere by Argo CD. It can be prematurely revoked by removing the entry from this list.
    jwtTokens:
    - iat: 1535390316
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: hello-world
spec:
  project: argocd-poc
  syncPolicy:
    automated:
      prune: true
  source:
    repoURL: https://github.com/cruisehall/hello-world-golang-server.git
    targetRevision: master
    path: k8s
  destination:
    server: https://kubernetes.default.svc
    namespace: hw-go